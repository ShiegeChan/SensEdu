---
title: EMG BioInputs
layout: default
parent: Projects
math: mathjax
nav_order: 4
---

# EMG BioInputs
{: .fs-8 .fw-500 .no_toc}
---

- TOC
{:toc}

## Introduction

[Electromyography](https://en.wikipedia.org/wiki/Electromyography) (EMG) is a widely-used technique for recording and analyzing electrical activities generated by skeletal muscles.

EMG is appealing due to its simplicity when detecting basic movements, such as a biceps contraction. For such projects, advanced hardware or complex signal processing is often unnecessary. This makes EMG an accessible tool for beginners as an introduction into biomedical engineering projects. Furthermore, the foundational concepts learned through EMG can be extended to related fields, including [Electrocardiography](https://en.wikipedia.org/wiki/Electrocardiography) (ECG), [Electrooculography](https://en.wikipedia.org/wiki/Electrooculography) (EOG), [Electroencephalography](https://en.wikipedia.org/wiki/Electroencephalography) (EEG), and others.

In SensEdu, we demonstrate how basic biceps contraction can be used to simulate keyboard press logic, with latency of ~100â€“200ms. We use the most basic circuit design combined with signal processing in MATLAB.

This page will guide you step-by-step through the required setup and knowledge to create a simple yet effective demonstration of a typical biomedical engineering project.

## Biological Background

First, we need to understand what we are trying to measure.

The most important thing that we need to look at is called [Neuromuscular Junction](https://en.wikipedia.org/wiki/Neuromuscular_junction) (NMJ). It is a specialized [synapse](https://en.wikipedia.org/wiki/Synapse) that connects [motor neurons](https://www.simplypsychology.org/motor-neuron.html) and skeletal muscle fibers. It is the main part that is responsible for converting our neural signals to muscle contraction. Let's break it down how NMJ works.

{: .TIP}
Highly recommended to watch the video [Neuromuscular Junction](https://youtu.be/_k6QINRcdV4?si=TG5Yw0wvDcTJtR6G) by [Byte Size Med].

The signal path starts with motor neuron sending electrical signal called [Action Potential] to the NMJ. In response, a bunch of voltage gated sodium channels gets activated, and sodium (positive charged ion) enters the cell. Cell's membrane gets depolarized and it activated calcium flow into the cell. Calcium causes little containers with [neurotransmitters](https://en.wikipedia.org/wiki/Neurotransmitter) called [vesicles](https://en.wikipedia.org/wiki/Synaptic_vesicle) to fuse with the membrane and release neurotransmitters [Acetylcholine](https://en.wikipedia.org/wiki/Acetylcholine) (ACh).

<img src="{{site.baseurl}}/assets/images/NMJ1.png" alt="drawing"/>
{: .text-center .mb-1}

[Exocytosis](https://en.wikipedia.org/wiki/Exocytosis) (source: [Byte Size Med])
{: .text-center .mt-0}

ACh travels through synaptic space and binds to its receptors. In response to a neurotransmitter, [ligand-gated ion channels](https://en.wikipedia.org/wiki/Ligand-gated_ion_channel) allow different ions to enter the muscle cell, which causes membrane depolarization. Which causes resting voltage of a membrane at around -90mV to go up.

<img src="{{site.baseurl}}/assets/images/NMJ2.png" alt="drawing"/>
{: .text-center .mb-1}

Depolarization due to opened ligand-gated ion channels (source: [Byte Size Med])
{: .text-center .mt-0}

With a lot of this neurotransmitters, the voltage goes up more and more and at certain point reaches the threshold at around -50mV, where voltage-gated sodium channels are opened, causing sodium to rush into the cell. It finishes the muscle depolarization and generates an Action Potential on a muscle membrane which gets propagated along the muscle membrane and causing muscle contraction.

<img src="{{site.baseurl}}/assets/images/NMJ3.png" alt="drawing"/>
{: .text-center .mb-1}

[Excitation Contraction Coupling](https://www.sciencedirect.com/topics/medicine-and-dentistry/excitation-contraction-coupling) (source: [Byte Size Med])
{: .text-center .mt-0}

{: .NOTE}
If you get lost, the main takeaway: we are basically converting neural electrical signal to chemical and then back to electrical signal in a muscle. It propagated along muscle fibers and causes contractions.
This electrical signal is called [Action Potential], which we can measure.

## Hardware Setup

anplifier, script, basic circuit, converter, all required elements


## Signal Processing

matlab magic

## Testing

## Showcase

## Possible improvements

## Sources

## Appendix: data recordings for improvements


SensEdu is equipped with x2 [AD8222] Instrumentation Amplifier ([datasheet]).

Each Amplifier is dual-channel, so we have 4 channels in total. All channels are accessible from the following Jumpers:
* J9: 1st Channel of U5 -> outputs MIC5 - A0 - ADC12_INP4
* J11: 2nd Channel of U5 -> outputs MIC6 - A2 - ADC12_INP9
* J12: 1st Channel of U6 -> outputs MIC7 - A11 - ADC12_INP0
* J20: 2nd Channel of U6 -> outputs MIC8 - A7 - ADC1_INP16

Refer to the [ADC mapping table](/SensEdu/Library/ADC/#adc_mapping) for better understanding.

Circuit for each of the amplifier:

<img src="{{site.baseurl}}/assets/images/amp_circuit.png" alt="drawing"/>
{: .text-center}

Electrode mapping:
* Tip: Red
* Ring: Blue
* Sleeve: Black

## Test

WASD Dark Souls for 4 channels?

## capacitive input
ignore some of the first samples for ADC stabilization

https://devzone.nordicsemi.com/f/nordic-q-a/80796/adc---first-read-is-always-wrong/336435

## history
A 1-second history allows the filter to capture multiple cycles of low-frequency components, such as 10Hz (1 cycle every 100ms) or even lower frequencies (e.g., motion artifacts below 10Hz). This improves:

The filter's ability to attenuate noise and artifacts.
The preservation of desired signal components, especially in the lower frequency band.

A longer history allows low-pass filters (used in envelope detection) to smooth the rectified signal over a larger time frame, resulting in a more robust and stable envelope.
For example, a 5Hz low-pass filter requires at least 200ms of data for one full cycle. With a 1-second history, the envelope will be less sensitive to short-term fluctuations or noise.

 Sliding Overlapping Windows

Use a 1-second buffer for filtering and envelope detection, but process overlapping chunks (e.g., update every 40ms). This ensures that decisions are updated frequently without sacrificing the filtering accuracy of the longer window.

## good study on perfect high pass value
https://www.bu.edu/nmrc/files/2010/06/103.pdf

## Good Resources:
* https://www.nature.com/articles/s41597-022-01484-2

## Sources:
* https://youtu.be/_k6QINRcdV4?si=rnil7B-ZlqmRCGSN
* https://youtu.be/ApaPlKPb4ek?si=rHncr0b2XipqN83i

## Improvements
* Implement filtering in hardware, you can extend SensEdu with another custom shield which will make half of current signal processing unnecessary greatly reducing latency and required computations. In addition, use right leg drive to decrease noise and offset.
* mkm

[Byte Size Med]: https://www.youtube.com/channel/UCZghvlgylH3r_CWfA18eFRg
[Action Potential]: (https://en.wikipedia.org/wiki/Action_potential)
[AD8222]: https://www.analog.com/en/products/ad8222.html?doc=ad8222-KGD.pdf
[datasheet]: https://www.analog.com/media/en/technical-documentation/data-sheets/AD8222.pdf